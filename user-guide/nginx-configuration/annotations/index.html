



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.3">
    
    
      
        <title>Annotations - NGINX Ingress Controller</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../../extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#annotations" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="NGINX Ingress Controller" class="md-header-nav__button md-logo">
          
            <i class="md-icon">public</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                NGINX Ingress Controller
              </span>
              <span class="md-header-nav__topic">
                Annotations
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/kubernetes/ingress-nginx/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      kubernetes/ingress-nginx
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="Welcome" class="md-tabs__link">
        Welcome
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../deploy/" title="Deployment" class="md-tabs__link">
          Deployment
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="User guide" class="md-tabs__link md-tabs__link--active">
          User guide
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../examples/PREREQUISITES/" title="Examples" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon">public</i>
      
    </span>
    NGINX Ingress Controller
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/kubernetes/ingress-nginx/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      kubernetes/ingress-nginx
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../deploy/" title="Installation Guide" class="md-nav__link">
      Installation Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../deploy/rbac/" title="Role Based Access Control (RBAC)" class="md-nav__link">
      Role Based Access Control (RBAC)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      User guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        User guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      NGINX Configuration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        NGINX Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="NGINX Configuration" class="md-nav__link">
      NGINX Configuration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Annotations
      </label>
    
    <a href="./" title="Annotations" class="md-nav__link md-nav__link--active">
      Annotations
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rewrite" title="Rewrite" class="md-nav__link">
    Rewrite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-affinity" title="Session Affinity" class="md-nav__link">
    Session Affinity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-nginx-upstream-checks" title="Custom NGINX upstream checks" class="md-nav__link">
    Custom NGINX upstream checks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-nginx-upstream-hashing" title="Custom NGINX upstream hashing" class="md-nav__link">
    Custom NGINX upstream hashing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-nginx-load-balancing" title="Custom NGINX load balancing" class="md-nav__link">
    Custom NGINX load balancing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-nginx-upstream-vhost" title="Custom NGINX upstream vhost" class="md-nav__link">
    Custom NGINX upstream vhost
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-certificate-authentication" title="Client Certificate Authentication" class="md-nav__link">
    Client Certificate Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-snippet" title="Configuration snippet" class="md-nav__link">
    Configuration snippet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-backend" title="Default Backend" class="md-nav__link">
    Default Backend
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-cors" title="Enable CORS" class="md-nav__link">
    Enable CORS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-alias" title="Server Alias" class="md-nav__link">
    Server Alias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-snippet" title="Server snippet" class="md-nav__link">
    Server snippet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-body-buffer-size" title="Client Body Buffer Size" class="md-nav__link">
    Client Body Buffer Size
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-authentication" title="External Authentication" class="md-nav__link">
    External Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting" title="Rate limiting" class="md-nav__link">
    Rate limiting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permanent-redirect" title="Permanent Redirect" class="md-nav__link">
    Permanent Redirect
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl-passthrough" title="SSL Passthrough" class="md-nav__link">
    SSL Passthrough
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-backends" title="Secure backends" class="md-nav__link">
    Secure backends
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-upstream" title="Service Upstream" class="md-nav__link">
    Service Upstream
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#known-issues" title="Known Issues" class="md-nav__link">
    Known Issues
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-side-https-enforcement-through-redirect" title="Server-side HTTPS enforcement through redirect" class="md-nav__link">
    Server-side HTTPS enforcement through redirect
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redirect-from-to-www" title="Redirect from to www" class="md-nav__link">
    Redirect from to www
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whitelist-source-range" title="Whitelist source range" class="md-nav__link">
    Whitelist source range
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-affinity" title="Cookie affinity" class="md-nav__link">
    Cookie affinity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-timeouts" title="Custom timeouts" class="md-nav__link">
    Custom timeouts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxy-redirect" title="Proxy redirect" class="md-nav__link">
    Proxy redirect
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-max-body-size" title="Custom max body size" class="md-nav__link">
    Custom max body size
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxy-buffering" title="Proxy buffering" class="md-nav__link">
    Proxy buffering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl-ciphers" title="SSL ciphers" class="md-nav__link">
    SSL ciphers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connection-proxy-header" title="Connection proxy header" class="md-nav__link">
    Connection proxy header
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-access-log" title="Enable Access Log" class="md-nav__link">
    Enable Access Log
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-rewrite-log" title="Enable Rewrite Log" class="md-nav__link">
    Enable Rewrite Log
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lua-resty-waf" title="Lua Resty WAF" class="md-nav__link">
    Lua Resty WAF
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grpc-backend" title="gRPC backend" class="md-nav__link">
    gRPC backend
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configmap/" title="ConfigMaps" class="md-nav__link">
      ConfigMaps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../custom-template/" title="Custom NGINX template" class="md-nav__link">
      Custom NGINX template
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../log-format/" title="Log format" class="md-nav__link">
      Log format
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli-arguments/" title="Command line arguments" class="md-nav__link">
      Command line arguments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-errors/" title="Custom errors" class="md-nav__link">
      Custom errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exposing-tcp-udp-services/" title="Exposing TCP and UDP services" class="md-nav__link">
      Exposing TCP and UDP services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../external-articles/" title="External Articles" class="md-nav__link">
      External Articles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../miscellaneous/" title="Miscellaneous" class="md-nav__link">
      Miscellaneous
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../multiple-ingress/" title="Multiple ingress controllers" class="md-nav__link">
      Multiple ingress controllers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../nginx-status-page/" title="NGINX status page" class="md-nav__link">
      NGINX status page
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tls/" title="TLS" class="md-nav__link">
      TLS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-10" type="checkbox" id="nav-3-10">
    
    <label class="md-nav__link" for="nav-3-10">
      Third party addons
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-10">
        Third party addons
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../third-party-addons/modsecurity/" title="ModSecurity Web Application Firewall" class="md-nav__link">
      ModSecurity Web Application Firewall
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../third-party-addons/opentracing/" title="OpenTracing" class="md-nav__link">
      OpenTracing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/PREREQUISITES/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/README/" title="Ingress examples" class="md-nav__link">
      Ingress examples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/affinity/cookie/README/" title="Sticky Session" class="md-nav__link">
      Sticky Session
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Auth
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Auth
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/auth/basic/README/" title="Basic Authentication" class="md-nav__link">
      Basic Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/auth/client-certs/README/" title="Client Certificate Authentication" class="md-nav__link">
      Client Certificate Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/auth/external-auth/README/" title="External authentication" class="md-nav__link">
      External authentication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Customization
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Customization
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/customization/configuration-snippets/README/" title="Configuration Snippets" class="md-nav__link">
      Configuration Snippets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/customization/custom-configuration/README/" title="Custom Configuration" class="md-nav__link">
      Custom Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/customization/custom-errors/README/" title="Custom Errors" class="md-nav__link">
      Custom Errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/customization/custom-headers/README/" title="Custom Headers" class="md-nav__link">
      Custom Headers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/customization/custom-upstream-check/README/" title="Custom Upstream server checks" class="md-nav__link">
      Custom Upstream server checks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/customization/custom-vts-metrics-prometheus/README/" title="Deploying the Nginx Ingress controller" class="md-nav__link">
      Deploying the Nginx Ingress controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/customization/external-auth-headers/README/" title="External authentication, authentication service response headers propagation" class="md-nav__link">
      External authentication, authentication service response headers propagation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/customization/ssl-dh-param/README/" title="Deploying the Nginx Ingress controller" class="md-nav__link">
      Deploying the Nginx Ingress controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/customization/sysctl/README/" title="Sysctl tuning" class="md-nav__link">
      Sysctl tuning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/docker-registry/README/" title="Docker registry" class="md-nav__link">
      Docker registry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/external-auth/README/" title="External Authentication" class="md-nav__link">
      External Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/multi-tls/README/" title="Multi TLS certificate termination" class="md-nav__link">
      Multi TLS certificate termination
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/rewrite/README/" title="Rewrite" class="md-nav__link">
      Rewrite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/static-ip/README/" title="Static IPs" class="md-nav__link">
      Static IPs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/tls-termination/README/" title="TLS termination" class="md-nav__link">
      TLS termination
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../development/" title="Developing for NGINX Ingress Controller" class="md-nav__link">
      Developing for NGINX Ingress Controller
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../ingress-controller-catalog/" title="Ingress Controller Catalog" class="md-nav__link">
      Ingress Controller Catalog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../troubleshooting/" title="Debug & Troubleshooting" class="md-nav__link">
      Debug & Troubleshooting
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rewrite" title="Rewrite" class="md-nav__link">
    Rewrite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-affinity" title="Session Affinity" class="md-nav__link">
    Session Affinity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-nginx-upstream-checks" title="Custom NGINX upstream checks" class="md-nav__link">
    Custom NGINX upstream checks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-nginx-upstream-hashing" title="Custom NGINX upstream hashing" class="md-nav__link">
    Custom NGINX upstream hashing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-nginx-load-balancing" title="Custom NGINX load balancing" class="md-nav__link">
    Custom NGINX load balancing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-nginx-upstream-vhost" title="Custom NGINX upstream vhost" class="md-nav__link">
    Custom NGINX upstream vhost
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-certificate-authentication" title="Client Certificate Authentication" class="md-nav__link">
    Client Certificate Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-snippet" title="Configuration snippet" class="md-nav__link">
    Configuration snippet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-backend" title="Default Backend" class="md-nav__link">
    Default Backend
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-cors" title="Enable CORS" class="md-nav__link">
    Enable CORS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-alias" title="Server Alias" class="md-nav__link">
    Server Alias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-snippet" title="Server snippet" class="md-nav__link">
    Server snippet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-body-buffer-size" title="Client Body Buffer Size" class="md-nav__link">
    Client Body Buffer Size
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-authentication" title="External Authentication" class="md-nav__link">
    External Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting" title="Rate limiting" class="md-nav__link">
    Rate limiting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permanent-redirect" title="Permanent Redirect" class="md-nav__link">
    Permanent Redirect
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl-passthrough" title="SSL Passthrough" class="md-nav__link">
    SSL Passthrough
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-backends" title="Secure backends" class="md-nav__link">
    Secure backends
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-upstream" title="Service Upstream" class="md-nav__link">
    Service Upstream
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#known-issues" title="Known Issues" class="md-nav__link">
    Known Issues
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-side-https-enforcement-through-redirect" title="Server-side HTTPS enforcement through redirect" class="md-nav__link">
    Server-side HTTPS enforcement through redirect
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redirect-from-to-www" title="Redirect from to www" class="md-nav__link">
    Redirect from to www
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whitelist-source-range" title="Whitelist source range" class="md-nav__link">
    Whitelist source range
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-affinity" title="Cookie affinity" class="md-nav__link">
    Cookie affinity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-timeouts" title="Custom timeouts" class="md-nav__link">
    Custom timeouts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxy-redirect" title="Proxy redirect" class="md-nav__link">
    Proxy redirect
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-max-body-size" title="Custom max body size" class="md-nav__link">
    Custom max body size
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxy-buffering" title="Proxy buffering" class="md-nav__link">
    Proxy buffering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl-ciphers" title="SSL ciphers" class="md-nav__link">
    SSL ciphers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connection-proxy-header" title="Connection proxy header" class="md-nav__link">
    Connection proxy header
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-access-log" title="Enable Access Log" class="md-nav__link">
    Enable Access Log
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-rewrite-log" title="Enable Rewrite Log" class="md-nav__link">
    Enable Rewrite Log
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lua-resty-waf" title="Lua Resty WAF" class="md-nav__link">
    Lua Resty WAF
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grpc-backend" title="gRPC backend" class="md-nav__link">
    gRPC backend
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/kubernetes/ingress-nginx/edit/master/docs/user-guide/nginx-configuration/annotations.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="annotations">Annotations<a class="headerlink" href="#annotations" title="Permanent link">&para;</a></h1>
<p>You can add these Kubernetes annotations to specific Ingress objects to customize their behavior.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Annotation keys and values can only be strings.
Other types, such as boolean or numeric values must be quoted,
i.e. <code class="codehilite">&quot;true&quot;</code>, <code class="codehilite">&quot;false&quot;</code>, <code class="codehilite">&quot;100&quot;</code>.</p>
</div>
<table>
<thead>
<tr>
<th>Name</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#rewrite">nginx.ingress.kubernetes.io/add-base-url</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#rewrite">nginx.ingress.kubernetes.io/app-root</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#session-affinity">nginx.ingress.kubernetes.io/affinity</a></td>
<td>cookie</td>
</tr>
<tr>
<td><a href="#authentication">nginx.ingress.kubernetes.io/auth-realm</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#authentication">nginx.ingress.kubernetes.io/auth-secret</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#authentication">nginx.ingress.kubernetes.io/auth-type</a></td>
<td>basic or digest</td>
</tr>
<tr>
<td><a href="#client-certificate-authentication">nginx.ingress.kubernetes.io/auth-tls-secret</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#client-certificate-authentication">nginx.ingress.kubernetes.io/auth-tls-verify-depth</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#client-certificate-authentication">nginx.ingress.kubernetes.io/auth-tls-verify-client</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#client-certificate-authentication">nginx.ingress.kubernetes.io/auth-tls-error-page</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#client-certificate-authentication">nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#external-authentication">nginx.ingress.kubernetes.io/auth-url</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#rewrite">nginx.ingress.kubernetes.io/base-url-scheme</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#client-body-buffer-size">nginx.ingress.kubernetes.io/client-body-buffer-size</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#configuration-snippet">nginx.ingress.kubernetes.io/configuration-snippet</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#default-backend">nginx.ingress.kubernetes.io/default-backend</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#enable-cors">nginx.ingress.kubernetes.io/enable-cors</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#enable-cors">nginx.ingress.kubernetes.io/cors-allow-origin</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#enable-cors">nginx.ingress.kubernetes.io/cors-allow-methods</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#enable-cors">nginx.ingress.kubernetes.io/cors-allow-headers</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#enable-cors">nginx.ingress.kubernetes.io/cors-allow-credentials</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#enable-cors">nginx.ingress.kubernetes.io/cors-max-age</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#server-side-https-enforcement-through-redirect">nginx.ingress.kubernetes.io/force-ssl-redirect</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#redirect-from-to-www">nginx.ingress.kubernetes.io/from-to-www-redirect</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#grpc-backend">nginx.ingress.kubernetes.io/grpc-backend</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#rate-limiting">nginx.ingress.kubernetes.io/limit-connections</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#rate-limiting">nginx.ingress.kubernetes.io/limit-rps</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#permanent-redirect">nginx.ingress.kubernetes.io/permanent-redirect</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#custom-max-body-size">nginx.ingress.kubernetes.io/proxy-body-size</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#custom-timeouts">nginx.ingress.kubernetes.io/proxy-connect-timeout</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#custom-timeouts">nginx.ingress.kubernetes.io/proxy-send-timeout</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#custom-timeouts">nginx.ingress.kubernetes.io/proxy-read-timeout</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#custom-timeouts">nginx.ingress.kubernetes.io/proxy-next-upstream</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#custom-timeouts">nginx.ingress.kubernetes.io/proxy-next-upstream-tries</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#custom-timeouts">nginx.ingress.kubernetes.io/proxy-request-buffering</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#proxy-redirect">nginx.ingress.kubernetes.io/proxy-redirect-from</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#proxy-redirect">nginx.ingress.kubernetes.io/proxy-redirect-to</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#enable-rewrite-log">nginx.ingress.kubernetes.io/rewrite-log</a></td>
<td>URI</td>
</tr>
<tr>
<td><a href="#rewrite">nginx.ingress.kubernetes.io/rewrite-target</a></td>
<td>URI</td>
</tr>
<tr>
<td><a href="#secure-backends">nginx.ingress.kubernetes.io/secure-backends</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#secure-backends">nginx.ingress.kubernetes.io/secure-verify-ca-secret</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#server-alias">nginx.ingress.kubernetes.io/server-alias</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#server-snippet">nginx.ingress.kubernetes.io/server-snippet</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#service-upstream">nginx.ingress.kubernetes.io/service-upstream</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#cookie-affinity">nginx.ingress.kubernetes.io/session-cookie-name</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#cookie-affinity">nginx.ingress.kubernetes.io/session-cookie-hash</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#server-side-https-enforcement-through-redirect">nginx.ingress.kubernetes.io/ssl-redirect</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#ssl-passthrough">nginx.ingress.kubernetes.io/ssl-passthrough</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#custom-nginx-upstream-checks">nginx.ingress.kubernetes.io/upstream-max-fails</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#custom-nginx-upstream-checks">nginx.ingress.kubernetes.io/upstream-fail-timeout</a></td>
<td>number</td>
</tr>
<tr>
<td><a href="#custom-nginx-upstream-hashing">nginx.ingress.kubernetes.io/upstream-hash-by</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#custom-nginx-load-balancing">nginx.ingress.kubernetes.io/load-balance</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#custom-nginx-upstream-vhost">nginx.ingress.kubernetes.io/upstream-vhost</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#whitelist-source-range">nginx.ingress.kubernetes.io/whitelist-source-range</a></td>
<td>CIDR</td>
</tr>
<tr>
<td><a href="#proxy-buffering">nginx.ingress.kubernetes.io/proxy-buffering</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#ssl-ciphers">nginx.ingress.kubernetes.io/ssl-ciphers</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#connection-proxy-header">nginx.ingress.kubernetes.io/connection-proxy-header</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#enable-access-log">nginx.ingress.kubernetes.io/enable-access-log</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#lua-resty-waf">nginx.ingress.kubernetes.io/lua-resty-waf</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#lua-resty-waf">nginx.ingress.kubernetes.io/lua-resty-waf-debug</a></td>
<td>"true" or "false"</td>
</tr>
<tr>
<td><a href="#lua-resty-waf">nginx.ingress.kubernetes.io/lua-resty-waf-ignore-rulesets</a></td>
<td>string</td>
</tr>
<tr>
<td><a href="#lua-resty-waf">nginx.ingress.kubernetes.io/lua-resty-waf-extra-rules</a></td>
<td>string</td>
</tr>
</tbody>
</table>
<h3 id="rewrite">Rewrite<a class="headerlink" href="#rewrite" title="Permanent link">&para;</a></h3>
<p>In some scenarios the exposed URL in the backend service differs from the specified path in the Ingress rule. Without a rewrite any request will return 404.
Set the annotation <code class="codehilite">nginx.ingress.kubernetes.io/rewrite-target</code> to the path expected by the service.</p>
<p>If the application contains relative links it is possible to add an additional annotation <code class="codehilite">nginx.ingress.kubernetes.io/add-base-url</code> that will prepend a <a href="https://developer.mozilla.org/en/docs/Web/HTML/Element/base"><code class="codehilite">base</code> tag</a> in the header of the returned HTML from the backend.</p>
<p>If the scheme of <a href="https://developer.mozilla.org/en/docs/Web/HTML/Element/base"><code class="codehilite">base</code> tag</a> need to be specific, set the annotation <code class="codehilite">nginx.ingress.kubernetes.io/base-url-scheme</code> to the scheme such as <code class="codehilite">http</code> and <code class="codehilite">https</code>.</p>
<p>If the Application Root is exposed in a different path and needs to be redirected, set the annotation <code class="codehilite">nginx.ingress.kubernetes.io/app-root</code> to redirect requests for <code class="codehilite">/</code>.</p>
<p>Please check the <a href="../../../examples/rewrite/README/">rewrite</a> example.</p>
<h3 id="session-affinity">Session Affinity<a class="headerlink" href="#session-affinity" title="Permanent link">&para;</a></h3>
<p>The annotation <code class="codehilite">nginx.ingress.kubernetes.io/affinity</code> enables and sets the affinity type in all Upstreams of an Ingress. This way, a request will always be directed to the same upstream server.
The only affinity type available for NGINX is <code class="codehilite">cookie</code>.</p>
<p>Please check the <a href="../../../examples/affinity/cookie/README/">affinity</a> example.</p>
<h3 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h3>
<p>Is possible to add authentication adding additional annotations in the Ingress rule. The source of the authentication is a secret that contains usernames and passwords inside the key <code class="codehilite">auth</code>.</p>
<p>The annotations are:</p>
<div class="codehilite"><pre><span></span>nginx.ingress.kubernetes.io/auth-type: [basic|digest]
</pre></div>


<p>Indicates the <a href="https://tools.ietf.org/html/rfc2617">HTTP Authentication Type: Basic or Digest Access Authentication</a>.</p>
<div class="codehilite"><pre><span></span>nginx.ingress.kubernetes.io/auth-secret: secretName
</pre></div>


<p>The name of the Secret that contains the usernames and passwords which are granted access to the <code class="codehilite">path</code>s defined in the Ingress rules.
This annotation also accepts the alternative form "namespace/secretName", in which case the Secret lookup is performed in the referenced namespace instead of the Ingress namespace.</p>
<div class="codehilite"><pre><span></span>nginx.ingress.kubernetes.io/auth-realm: &quot;realm string&quot;
</pre></div>


<p>Please check the <a href="../../../examples/auth/basic/README/">auth</a> example.</p>
<h3 id="custom-nginx-upstream-checks">Custom NGINX upstream checks<a class="headerlink" href="#custom-nginx-upstream-checks" title="Permanent link">&para;</a></h3>
<p>NGINX exposes some flags in the <a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream">upstream configuration</a> that enable the configuration of each server in the upstream. The Ingress controller allows custom <code class="codehilite">max_fails</code> and <code class="codehilite">fail_timeout</code> parameters in a global context using <code class="codehilite">upstream-max-fails</code> and <code class="codehilite">upstream-fail-timeout</code> in the NGINX ConfigMap or in a particular Ingress rule. <code class="codehilite">upstream-max-fails</code> defaults to 0. This means NGINX will respect the container's <code class="codehilite">readinessProbe</code> if it is defined. If there is no probe and no values for <code class="codehilite">upstream-max-fails</code> NGINX will continue to send traffic to the container.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>With the default configuration NGINX will not health check your backends. Whenever the endpoints controller notices a readiness probe failure, that pod's IP will be removed from the list of endpoints. This will trigger the NGINX controller to also remove it from the upstreams.**</p>
</div>
<p>To use custom values in an Ingress rule define these annotations:</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/upstream-max-fails</code>: number of unsuccessful attempts to communicate with the server that should occur in the duration set by the <code class="codehilite">upstream-fail-timeout</code> parameter to consider the server unavailable.</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/upstream-fail-timeout</code>: time in seconds during which the specified number of unsuccessful attempts to communicate with the server should occur to consider the server unavailable. This is also the period of time the server will be considered unavailable.</p>
<p>In NGINX, backend server pools are called "<a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html">upstreams</a>". Each upstream contains the endpoints for a service. An upstream is created for each service that has Ingress rules defined.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>All Ingress rules using the same service will use the same upstream. Only one of the Ingress rules should define annotations to configure the upstream servers.</p>
</div>
<p>Please check the <a href="../../../examples/customization/custom-upstream-check/README/">custom upstream check</a> example.</p>
<h3 id="custom-nginx-upstream-hashing">Custom NGINX upstream hashing<a class="headerlink" href="#custom-nginx-upstream-hashing" title="Permanent link">&para;</a></h3>
<p>NGINX supports load balancing by client-server mapping based on <a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#hash">consistent hashing</a> for a given key. The key can contain text, variables or any combination thereof. This feature allows for request stickiness other than client IP or cookies. The <a href="http://www.last.fm/user/RJ/journal/2007/04/10/392555/">ketama</a> consistent hashing method will be used which ensures only a few keys would be remapped to different servers on upstream group changes.</p>
<p>To enable consistent hashing for a backend:</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/upstream-hash-by</code>: the nginx variable, text value or any combination thereof to use for consistent hashing. For example <code class="codehilite">nginx.ingress.kubernetes.io/upstream-hash-by: &quot;$request_uri&quot;</code> to consistently hash upstream requests by the current request URI.</p>
<h3 id="custom-nginx-load-balancing">Custom NGINX load balancing<a class="headerlink" href="#custom-nginx-load-balancing" title="Permanent link">&para;</a></h3>
<p>This is similar to (https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/configmap.md#load-balance) but configures load balancing algorithm per ingress.</p>
<blockquote>
<p>Note that <code class="codehilite">nginx.ingress.kubernetes.io/upstream-hash-by</code> takes preference over this. If this and <code class="codehilite">nginx.ingress.kubernetes.io/upstream-hash-by</code> are not set then we fallback to using globally configured load balancing algorithm.</p>
</blockquote>
<h3 id="custom-nginx-upstream-vhost">Custom NGINX upstream vhost<a class="headerlink" href="#custom-nginx-upstream-vhost" title="Permanent link">&para;</a></h3>
<p>This configuration setting allows you to control the value for host in the following statement: <code class="codehilite">proxy_set_header Host $host</code>, which forms part of the location block.  This is useful if you need to call the upstream server by something other than <code class="codehilite">$host</code>.</p>
<h3 id="client-certificate-authentication">Client Certificate Authentication<a class="headerlink" href="#client-certificate-authentication" title="Permanent link">&para;</a></h3>
<p>It is possible to enable Client Certificate Authentication using additional annotations in Ingress Rule.</p>
<p>The annotations are:</p>
<div class="codehilite"><pre><span></span>nginx.ingress.kubernetes.io/auth-tls-secret: secretName
</pre></div>


<p>The name of the Secret that contains the full Certificate Authority chain <code class="codehilite">ca.crt</code> that is enabled to authenticate against this Ingress.
This annotation also accepts the alternative form "namespace/secretName", in which case the Secret lookup is performed in the referenced namespace instead of the Ingress namespace.</p>
<div class="codehilite"><pre><span></span>nginx.ingress.kubernetes.io/auth-tls-verify-depth
</pre></div>


<p>The validation depth between the provided client certificate and the Certification Authority chain.</p>
<div class="codehilite"><pre><span></span>nginx.ingress.kubernetes.io/auth-tls-verify-client
</pre></div>


<p>Enables verification of client certificates.</p>
<div class="codehilite"><pre><span></span>nginx.ingress.kubernetes.io/auth-tls-error-page
</pre></div>


<p>The URL/Page that user should be redirected in case of a Certificate Authentication Error</p>
<div class="codehilite"><pre><span></span>nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream
</pre></div>


<p>Indicates if the received certificates should be passed or not to the upstream server.
By default this is disabled.</p>
<p>Please check the <a href="../../../examples/auth/client-certs/README/">client-certs</a> example.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>TLS with Client Authentication is NOT possible in Cloudflare as is not allowed it and might result in unexpected behavior.</p>
<p>Cloudflare only allows Authenticated Origin Pulls and is required to use their own certificate: <a href="https://blog.cloudflare.com/protecting-the-origin-with-tls-authenticated-origin-pulls/">https://blog.cloudflare.com/protecting-the-origin-with-tls-authenticated-origin-pulls/</a></p>
<p>Only Authenticated Origin Pulls are allowed and can be configured by following their tutorial: <a href="https://support.cloudflare.com/hc/en-us/articles/204494148-Setting-up-NGINX-to-use-TLS-Authenticated-Origin-Pulls">https://support.cloudflare.com/hc/en-us/articles/204494148-Setting-up-NGINX-to-use-TLS-Authenticated-Origin-Pulls</a></p>
</div>
<h3 id="configuration-snippet">Configuration snippet<a class="headerlink" href="#configuration-snippet" title="Permanent link">&para;</a></h3>
<p>Using this annotation you can add additional configuration to the NGINX location. For example:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/configuration-snippet</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
  <span class="no">more_set_headers &quot;Request-Id: $req_id&quot;;</span>
</pre></div>


<h3 id="default-backend">Default Backend<a class="headerlink" href="#default-backend" title="Permanent link">&para;</a></h3>
<p>The ingress controller requires a default backend. This service handles the response when the service in the Ingress rule does not have endpoints.
This is a global configuration for the ingress controller. In some cases could be required to return a custom content or format. In this scenario we can use the annotation <code class="codehilite">nginx.ingress.kubernetes.io/default-backend: &lt;svc name&gt;</code> to specify a custom default backend.</p>
<h3 id="enable-cors">Enable CORS<a class="headerlink" href="#enable-cors" title="Permanent link">&para;</a></h3>
<p>To enable Cross-Origin Resource Sharing (CORS) in an Ingress rule add the annotation <code class="codehilite">nginx.ingress.kubernetes.io/enable-cors: &quot;true&quot;</code>. This will add a section in the server location enabling this functionality.</p>
<p>CORS can be controlled with the following annotations:</p>
<ul>
<li><code class="codehilite">nginx.ingress.kubernetes.io/cors-allow-methods</code> controls which methods are accepted. This is a multi-valued field, separated by ',' and accepts only letters (upper and lower case).</li>
</ul>
<p>Example: <code class="codehilite">nginx.ingress.kubernetes.io/cors-allow-methods: &quot;PUT, GET, POST, OPTIONS&quot;</code></p>
<ul>
<li><code class="codehilite">nginx.ingress.kubernetes.io/cors-allow-headers</code> controls which headers are accepted. This is a multi-valued field, separated by ',' and accepts letters, numbers, _ and -.</li>
</ul>
<p>Example: <code class="codehilite">nginx.ingress.kubernetes.io/cors-allow-headers: &quot;X-Forwarded-For, X-app123-XPTO&quot;</code></p>
<ul>
<li><code class="codehilite">nginx.ingress.kubernetes.io/cors-allow-origin</code> controls what's the accepted Origin for CORS and defaults to '*'. This is a single field value, with the following format: http(s)://origin-site.com or http(s)://origin-site.com:port</li>
</ul>
<p>Example: <code class="codehilite">nginx.ingress.kubernetes.io/cors-allow-origin: &quot;https://origin-site.com:4443&quot;</code></p>
<ul>
<li><code class="codehilite">nginx.ingress.kubernetes.io/cors-allow-credentials</code> controls if credentials can be passed during CORS operations.</li>
</ul>
<p>Example: <code class="codehilite">nginx.ingress.kubernetes.io/cors-allow-credentials: &quot;true&quot;</code></p>
<ul>
<li><code class="codehilite">nginx.ingress.kubernetes.io/cors-max-age</code> controls how long preflight requests can be cached.</li>
</ul>
<p>Example: <code class="codehilite">nginx.ingress.kubernetes.io/cors-max-age: 600</code></p>
<p>For more information please see <a href="https://enable-cors.org/server_nginx.html">https://enable-cors.org</a></p>
<h3 id="server-alias">Server Alias<a class="headerlink" href="#server-alias" title="Permanent link">&para;</a></h3>
<p>To add Server Aliases to an Ingress rule add the annotation <code class="codehilite">nginx.ingress.kubernetes.io/server-alias: &quot;&lt;alias&gt;&quot;</code>.
This will create a server with the same configuration, but a different server_name as the provided host.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A server-alias name cannot conflict with the hostname of an existing server. If it does the server-alias annotation will be ignored. If a server-alias is created and later a new server with the same hostname is created the new server configuration will take place over the alias configuration.</p>
</div>
<p>For more information please see <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#server_name">http://nginx.org</a></p>
<h3 id="server-snippet">Server snippet<a class="headerlink" href="#server-snippet" title="Permanent link">&para;</a></h3>
<p>Using the annotation <code class="codehilite">nginx.ingress.kubernetes.io/server-snippet</code> it is possible to add custom configuration in the server configuration block.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">annotations</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/server-snippet</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
<span class="l l-Scalar l-Scalar-Plain">set $agentflag 0;</span>

<span class="l l-Scalar l-Scalar-Plain">if ($http_user_agent ~* &quot;(Mobile)&quot; ){</span>
  <span class="l l-Scalar l-Scalar-Plain">set $agentflag 1;</span>
<span class="err">}</span>

<span class="l l-Scalar l-Scalar-Plain">if ( $agentflag = 1 ) {</span>
  <span class="l l-Scalar l-Scalar-Plain">return 301 https://m.example.com;</span>
<span class="err">}</span>
</pre></div>


<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This annotation can be used only once per host</p>
</div>
<h3 id="client-body-buffer-size">Client Body Buffer Size<a class="headerlink" href="#client-body-buffer-size" title="Permanent link">&para;</a></h3>
<p>Sets buffer size for reading client request body per location. In case the request body is larger than the buffer,
the whole body or only its part is written to a temporary file. By default, buffer size is equal to two memory pages.
This is 8K on x86, other 32-bit platforms, and x86-64. It is usually 16K on other 64-bit platforms. This annotation is
applied to each location provided in the ingress rule.</p>
<p><strong>Note:</strong> The annotation value must be given in a valid format otherwise the
For example to set the client-body-buffer-size the following can be done:</p>
<ul>
<li><code class="codehilite">nginx.ingress.kubernetes.io/client-body-buffer-size: &quot;1000&quot;</code> # 1000 bytes</li>
<li><code class="codehilite">nginx.ingress.kubernetes.io/client-body-buffer-size: 1k</code> # 1 kilobyte</li>
<li><code class="codehilite">nginx.ingress.kubernetes.io/client-body-buffer-size: 1K</code> # 1 kilobyte</li>
<li><code class="codehilite">nginx.ingress.kubernetes.io/client-body-buffer-size: 1m</code> # 1 megabyte</li>
<li><code class="codehilite">nginx.ingress.kubernetes.io/client-body-buffer-size: 1M</code> # 1 megabyte</li>
</ul>
<p>For more information please see <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#client_body_buffer_size">http://nginx.org</a></p>
<h3 id="external-authentication">External Authentication<a class="headerlink" href="#external-authentication" title="Permanent link">&para;</a></h3>
<p>To use an existing service that provides authentication the Ingress rule can be annotated with <code class="codehilite">nginx.ingress.kubernetes.io/auth-url</code> to indicate the URL where the HTTP request should be sent.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/auth-url</span><span class="p p-Indicator">:</span> <span class="s">&quot;URL</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">authentication</span><span class="nv"> </span><span class="s">service&quot;</span>
</pre></div>


<p>Additionally it is possible to set:</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/auth-method</code>: <code class="codehilite">&lt;Method&gt;</code> to specify the HTTP method to use.</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/auth-signin</code>: <code class="codehilite">&lt;SignIn_URL&gt;</code> to specify the location of the error page.</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/auth-response-headers</code>: <code class="codehilite">&lt;Response_Header_1, ..., Response_Header_n&gt;</code> to specify headers to pass to backend once authorization request completes.</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/auth-request-redirect</code>: <code class="codehilite">&lt;Request_Redirect_URL&gt;</code>  to specify the X-Auth-Request-Redirect header value.</p>
<p>Please check the <a href="../../../examples/auth/external-auth/README/">external-auth</a> example.</p>
<h3 id="rate-limiting">Rate limiting<a class="headerlink" href="#rate-limiting" title="Permanent link">&para;</a></h3>
<p>The annotations <code class="codehilite">nginx.ingress.kubernetes.io/limit-connections</code>, <code class="codehilite">nginx.ingress.kubernetes.io/limit-rps</code>, and <code class="codehilite">nginx.ingress.kubernetes.io/limit-rpm</code> define a limit on the connections that can be opened by a single client IP address. This can be used to mitigate <a href="https://www.nginx.com/blog/mitigating-ddos-attacks-with-nginx-and-nginx-plus">DDoS Attacks</a>.</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/limit-connections</code>: number of concurrent connections allowed from a single IP address.</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/limit-rps</code>: number of connections that may be accepted from a given IP each second.</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/limit-rpm</code>: number of connections that may be accepted from a given IP each minute.</p>
<p>You can specify the client IP source ranges to be excluded from rate-limiting through the <code class="codehilite">nginx.ingress.kubernetes.io/limit-whitelist</code> annotation. The value is a comma separated list of CIDRs.</p>
<p>If you specify multiple annotations in a single Ingress rule, <code class="codehilite">limit-rpm</code>, and then <code class="codehilite">limit-rps</code> takes precedence.</p>
<p>The annotation <code class="codehilite">nginx.ingress.kubernetes.io/limit-rate</code>, <code class="codehilite">nginx.ingress.kubernetes.io/limit-rate-after</code> define a limit the rate of response transmission to a client. The rate is specified in bytes per second. The zero value disables rate limiting. The limit is set per a request, and so if a client simultaneously opens two connections, the overall rate will be twice as much as the specified limit.</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/limit-rate-after</code>: sets the initial amount after which the further transmission of a response to a client will be rate limited.</p>
<p><code class="codehilite">nginx.ingress.kubernetes.io/limit-rate</code>: rate of request that accepted from a client each second.</p>
<p>To configure this setting globally for all Ingress rules, the <code class="codehilite">limit-rate-after</code> and <code class="codehilite">limit-rate</code> value may be set in the NGINX ConfigMap. if you set the value in ingress annotation will cover global setting.</p>
<h3 id="permanent-redirect">Permanent Redirect<a class="headerlink" href="#permanent-redirect" title="Permanent link">&para;</a></h3>
<p>This annotation allows to return a permanent redirect instead of sending data to the upstream.  For example <code class="codehilite">nginx.ingress.kubernetes.io/permanent-redirect: https://www.google.com</code> would redirect everything to Google.</p>
<h3 id="ssl-passthrough">SSL Passthrough<a class="headerlink" href="#ssl-passthrough" title="Permanent link">&para;</a></h3>
<p>The annotation <code class="codehilite">nginx.ingress.kubernetes.io/ssl-passthrough</code> allows to configure TLS termination in the pod and not in NGINX.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul>
<li>
<p>Using the annotation <code class="codehilite">nginx.ingress.kubernetes.io/ssl-passthrough</code> invalidates all the other available annotations. This is because SSL Passthrough works in L4 (TCP).</p>
</li>
<li>
<p>The use of this annotation requires Proxy Protocol to be enabled in the load-balancer. For example enabling Proxy Protocol for AWS ELB is described <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/enable-proxy-protocol.html">here</a>. If you're using ingress-controller without load balancer then the flag <code class="codehilite">--enable-ssl-passthrough</code> is required (by default it is disabled).</p>
</li>
</ul>
</div>
<h3 id="secure-backends">Secure backends<a class="headerlink" href="#secure-backends" title="Permanent link">&para;</a></h3>
<p>By default NGINX uses <code class="codehilite">http</code> to reach the services. Adding the annotation <code class="codehilite">nginx.ingress.kubernetes.io/secure-backends: &quot;true&quot;</code> in the Ingress rule changes the protocol to <code class="codehilite">https</code>.
If you want to validate the upstream against a specific certificate, you can create a secret with it and reference the secret with the annotation <code class="codehilite">nginx.ingress.kubernetes.io/secure-verify-ca-secret</code>.</p>
<blockquote>
<p>Note that if an invalid or non-existent secret is given, the NGINX ingress controller will ignore the <code class="codehilite">secure-backends</code> annotation.</p>
</blockquote>
<h3 id="service-upstream">Service Upstream<a class="headerlink" href="#service-upstream" title="Permanent link">&para;</a></h3>
<p>By default the NGINX ingress controller uses a list of all endpoints (Pod IP/port) in the NGINX upstream configuration. This annotation disables that behavior and instead uses a single upstream in NGINX, the service's Cluster IP and port. This can be desirable for things like zero-downtime deployments as it reduces the need to reload NGINX configuration when Pods come up and down. See issue <a href="https://github.com/kubernetes/ingress-nginx/issues/257">#257</a>.</p>
<h4 id="known-issues">Known Issues<a class="headerlink" href="#known-issues" title="Permanent link">&para;</a></h4>
<p>If the <code class="codehilite">service-upstream</code> annotation is specified the following things should be taken into consideration:</p>
<ul>
<li>Sticky Sessions will not work as only round-robin load balancing is supported.</li>
<li>The <code class="codehilite">proxy_next_upstream</code> directive will not have any effect meaning on error the request will not be dispatched to another upstream.</li>
</ul>
<h3 id="server-side-https-enforcement-through-redirect">Server-side HTTPS enforcement through redirect<a class="headerlink" href="#server-side-https-enforcement-through-redirect" title="Permanent link">&para;</a></h3>
<p>By default the controller redirects (301) to <code class="codehilite">HTTPS</code> if TLS is enabled for that ingress. If you want to disable that behavior globally, you can use <code class="codehilite">ssl-redirect: &quot;false&quot;</code> in the NGINX config map.</p>
<p>To configure this feature for specific ingress resources, you can use the <code class="codehilite">nginx.ingress.kubernetes.io/ssl-redirect: &quot;false&quot;</code> annotation in the particular resource.</p>
<p>When using SSL offloading outside of cluster (e.g. AWS ELB) it may be useful to enforce a redirect to <code class="codehilite">HTTPS</code> even when there is not TLS cert available. This can be achieved by using the <code class="codehilite">nginx.ingress.kubernetes.io/force-ssl-redirect: &quot;true&quot;</code> annotation in the particular resource.</p>
<h3 id="redirect-from-to-www">Redirect from to www<a class="headerlink" href="#redirect-from-to-www" title="Permanent link">&para;</a></h3>
<p>In some scenarios is required to redirect from <code class="codehilite">www.domain.com</code> to <code class="codehilite">domain.com</code> or viceversa.
To enable this feature use the annotation <code class="codehilite">nginx.ingress.kubernetes.io/from-to-www-redirect: &quot;true&quot;</code></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If at some point a new Ingress is created with a host equal to one of the options (like <code class="codehilite">domain.com</code>) the annotation will be omitted.</p>
</div>
<h3 id="whitelist-source-range">Whitelist source range<a class="headerlink" href="#whitelist-source-range" title="Permanent link">&para;</a></h3>
<p>You can specify the allowed client IP source ranges through the <code class="codehilite">nginx.ingress.kubernetes.io/whitelist-source-range</code> annotation. The value is a comma separated list of <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing">CIDRs</a>, e.g.  <code class="codehilite">10.0.0.0/24,172.10.0.1</code>.</p>
<p>To configure this setting globally for all Ingress rules, the <code class="codehilite">whitelist-source-range</code> value may be set in the NGINX ConfigMap.</p>
<p><strong>Note:</strong> Adding an annotation to an Ingress rule overrides any global restriction.</p>
<h3 id="cookie-affinity">Cookie affinity<a class="headerlink" href="#cookie-affinity" title="Permanent link">&para;</a></h3>
<p>If you use the <code class="codehilite">cookie</code> type you can also specify the name of the cookie that will be used to route the requests with the annotation <code class="codehilite">nginx.ingress.kubernetes.io/session-cookie-name</code>. The default is to create a cookie named 'INGRESSCOOKIE'.</p>
<p>In case of NGINX the annotation <code class="codehilite">nginx.ingress.kubernetes.io/session-cookie-hash</code> defines which algorithm will be used to 'hash' the used upstream. Default value is <code class="codehilite">md5</code> and possible values are <code class="codehilite">md5</code>, <code class="codehilite">sha1</code> and <code class="codehilite">index</code>.
The <code class="codehilite">index</code> option is not hashed, an in-memory index is used instead, it's quicker and the overhead is shorter Warning: the matching against upstream servers list is inconsistent. So, at reload, if upstreams servers has changed, index values are not guaranteed to correspond to the same server as before! <strong>USE IT WITH CAUTION</strong> and only if you need to!</p>
<p>In NGINX this feature is implemented by the third party module <a href="https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng">nginx-sticky-module-ng</a>. The workflow used to define which upstream server will be used is explained <a href="https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng/raw/08a395c66e425540982c00482f55034e1fee67b6/docs/sticky.pdf">here</a></p>
<h3 id="custom-timeouts">Custom timeouts<a class="headerlink" href="#custom-timeouts" title="Permanent link">&para;</a></h3>
<p>Using the configuration configmap it is possible to set the default global timeout for connections to the upstream servers.
In some scenarios is required to have different values. To allow this we provide annotations that allows this customization:</p>
<ul>
<li><code class="codehilite">nginx.ingress.kubernetes.io/proxy-connect-timeout</code></li>
<li><code class="codehilite">nginx.ingress.kubernetes.io/proxy-send-timeout</code></li>
<li><code class="codehilite">nginx.ingress.kubernetes.io/proxy-read-timeout</code></li>
<li><code class="codehilite">nginx.ingress.kubernetes.io/proxy-next-upstream</code></li>
<li><code class="codehilite">nginx.ingress.kubernetes.io/proxy-next-upstream-tries</code></li>
<li><code class="codehilite">nginx.ingress.kubernetes.io/proxy-request-buffering</code></li>
</ul>
<h3 id="proxy-redirect">Proxy redirect<a class="headerlink" href="#proxy-redirect" title="Permanent link">&para;</a></h3>
<p>With the annotations <code class="codehilite">nginx.ingress.kubernetes.io/proxy-redirect-from</code> and <code class="codehilite">nginx.ingress.kubernetes.io/proxy-redirect-to</code> it is possible to set the text that should be changed in the <code class="codehilite">Location</code> and <code class="codehilite">Refresh</code> header fields of a proxied server response (http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_redirect)
Setting "off" or "default" in the annotation <code class="codehilite">nginx.ingress.kubernetes.io/proxy-redirect-from</code> disables <code class="codehilite">nginx.ingress.kubernetes.io/proxy-redirect-to</code>
Both annotations will be used in any other case
By default the value is "off".</p>
<h3 id="custom-max-body-size">Custom max body size<a class="headerlink" href="#custom-max-body-size" title="Permanent link">&para;</a></h3>
<p>For NGINX, 413 error will be returned to the client when the size in a request exceeds the maximum allowed size of the client request body. This size can be configured by the parameter <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size"><code class="codehilite">client_max_body_size</code></a>.</p>
<p>To configure this setting globally for all Ingress rules, the <code class="codehilite">proxy-body-size</code> value may be set in the NGINX ConfigMap.
To use custom values in an Ingress rule define these annotation:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8m</span>
</pre></div>


<h3 id="proxy-buffering">Proxy buffering<a class="headerlink" href="#proxy-buffering" title="Permanent link">&para;</a></h3>
<p>Enable or disable proxy buffering <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering"><code class="codehilite">proxy_buffering</code></a>.
By default proxy buffering is disabled in the nginx config.</p>
<p>To configure this setting globally for all Ingress rules, the <code class="codehilite">proxy-buffering</code> value may be set in the NGINX ConfigMap.
To use custom values in an Ingress rule define these annotation:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/proxy-buffering</span><span class="p p-Indicator">:</span> <span class="s">&quot;on&quot;</span>
</pre></div>


<h3 id="ssl-ciphers">SSL ciphers<a class="headerlink" href="#ssl-ciphers" title="Permanent link">&para;</a></h3>
<p>Specifies the <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_ciphers">enabled ciphers</a>.</p>
<p>Using this annotation will set the <code class="codehilite">ssl_ciphers</code> directive at the server level. This configuration is active for all the paths in the host.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/ssl-ciphers</span><span class="p p-Indicator">:</span> <span class="s">&quot;ALL:!aNULL:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP&quot;</span>
</pre></div>


<h3 id="connection-proxy-header">Connection proxy header<a class="headerlink" href="#connection-proxy-header" title="Permanent link">&para;</a></h3>
<p>Using this annotation will override the default connection header set by nginx. To use custom values in an Ingress rule, define the annotation:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/connection-proxy-header</span><span class="p p-Indicator">:</span> <span class="s">&quot;keep-alive&quot;</span>
</pre></div>


<h3 id="enable-access-log">Enable Access Log<a class="headerlink" href="#enable-access-log" title="Permanent link">&para;</a></h3>
<p>In some scenarios could be required to disable NGINX access logs. To enable this feature use the annotation:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/enable-access-log</span><span class="p p-Indicator">:</span> <span class="s">&quot;false&quot;</span>
</pre></div>


<h3 id="enable-rewrite-log">Enable Rewrite Log<a class="headerlink" href="#enable-rewrite-log" title="Permanent link">&para;</a></h3>
<p>In some scenarios it could be required to enable NGINX rewrite logs. Note that rewrite logs are sent to the error_log file at the notice level. To enable this feature use the annotation:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/enable-rewrite-log</span><span class="p p-Indicator">:</span> <span class="s">&quot;true&quot;</span>
</pre></div>


<h3 id="lua-resty-waf">Lua Resty WAF<a class="headerlink" href="#lua-resty-waf" title="Permanent link">&para;</a></h3>
<p>Using <code class="codehilite">lua-resty-waf-*</code> annotations we can enable and control <a href="https://github.com/p0pr0ck5/lua-resty-waf">lua-resty-waf</a> per location.
Following configuration will enable WAF for the paths defined in the corresponding ingress:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/lua-resty-waf</span><span class="p p-Indicator">:</span> <span class="s">&quot;active&quot;</span>
</pre></div>


<p>In order to run it in debugging mode you can set <code class="codehilite">nginx.ingress.kubernetes.io/lua-resty-waf-debug</code> to <code class="codehilite">&quot;true&quot;</code> in addition to the above configuration.
The other possible values for <code class="codehilite">nginx.ingress.kubernetes.io/lua-resty-waf</code> are <code class="codehilite">inactive</code> and <code class="codehilite">simulate</code>. In <code class="codehilite">inactive</code> mode WAF won't do anything, whereas
in <code class="codehilite">simulate</code> mode it will log a warning message if there's a matching WAF rule for given request. This is useful to debug a rule and eliminate possible false positives before fully deploying it.</p>
<p><code class="codehilite">lua-resty-waf</code> comes with predefined set of rules <a href="https://github.com/p0pr0ck5/lua-resty-waf/tree/84b4f40362500dd0cb98b9e71b5875cb1a40f1ad/rules">https://github.com/p0pr0ck5/lua-resty-waf/tree/84b4f40362500dd0cb98b9e71b5875cb1a40f1ad/rules</a> that covers ModSecurity CRS.
You can use <code class="codehilite">nginx.ingress.kubernetes.io/lua-resty-waf-ignore-rulesets</code> to ignore subset of those rulesets. For an example:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/lua-resty-waf-ignore-rulesets</span><span class="p p-Indicator">:</span> <span class="s">&quot;41000_sqli,</span><span class="nv"> </span><span class="s">42000_xss&quot;</span>
</pre></div>


<p>will ignore the two mentioned rulesets.</p>
<p>It is also possible to configure custom WAF rules per ingress using <code class="codehilite">nginx.ingress.kubernetes.io/lua-resty-waf-extra-rules</code> annotation. For an example the following snippet will
configure a WAF rule to deny requests with query string value that contains word <code class="codehilite">foo</code>:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/lua-resty-waf-extra-rules</span><span class="p p-Indicator">:</span> <span class="s">&#39;[=[</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">&quot;access&quot;:</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">&quot;actions&quot;:</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">&quot;disrupt&quot;</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">&quot;DENY&quot;</span><span class="nv"> </span><span class="s">},</span><span class="nv"> </span><span class="s">&quot;id&quot;:</span><span class="nv"> </span><span class="s">10001,</span><span class="nv"> </span><span class="s">&quot;msg&quot;:</span><span class="nv"> </span><span class="s">&quot;my</span><span class="nv"> </span><span class="s">custom</span><span class="nv"> </span><span class="s">rule&quot;,</span><span class="nv"> </span><span class="s">&quot;operator&quot;:</span><span class="nv"> </span><span class="s">&quot;STR_CONTAINS&quot;,</span><span class="nv"> </span><span class="s">&quot;pattern&quot;:</span><span class="nv"> </span><span class="s">&quot;foo&quot;,</span><span class="nv"> </span><span class="s">&quot;vars&quot;:</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">&quot;parse&quot;:</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">&quot;values&quot;,</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">],</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;REQUEST_ARGS&quot;</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">]</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">],</span><span class="nv"> </span><span class="s">&quot;body_filter&quot;:</span><span class="nv"> </span><span class="s">[],</span><span class="nv"> </span><span class="s">&quot;header_filter&quot;:[]</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">]=]&#39;</span>
</pre></div>


<p>For details on how to write WAF rules, please refer to <a href="https://github.com/p0pr0ck5/lua-resty-waf">https://github.com/p0pr0ck5/lua-resty-waf</a>.</p>
<h3 id="grpc-backend">gRPC backend<a class="headerlink" href="#grpc-backend" title="Permanent link">&para;</a></h3>
<p>Since NGINX 1.13.10 it is possible to expose <a href="http://nginx.org/en/docs/http/ngx_http_grpc_module.html">gRPC services natively</a></p>
<p>You only need to add the annotation <code class="codehilite">nginx.ingress.kubernetes.io/grpc-backend: &quot;true&quot;</code> to enable this feature. Additionally, if the gRPC service requires TLS <code class="codehilite">nginx.ingress.kubernetes.io/secure-backends: &quot;true&quot;</code></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This feature requires HTTP2 to work which means we need to expose this service using HTTPS.</p>
</div>
<p>Exposing a gRPC service using HTTP is not supported.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="NGINX Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                NGINX Configuration
              </span>
            </div>
          </a>
        
        
          <a href="../configmap/" title="ConfigMaps" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                ConfigMaps
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-118407822-1","kubernetes.github.io"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>